piranha.contentedit=new Vue({el:"#contentedit",data:{loading:!0,id:null,languageId:null,typeId:null,typeTitle:null,groupId:null,groupTitle:null,title:null,excerpt:null,state:"new",regions:[],editors:[],useCategory:!1,useTags:!1,usePrimaryImage:!0,useExcerpt:!0,useHtmlExcerpt:!0,useTranslations:!1,permissions:[],languages:[],primaryImage:{id:null,media:null},selectedPermissions:[],saving:!1,selectedRegion:"",selectedSetting:"uid-settings"},computed:{contentRegions:function(){return this.regions.filter(function(e){return"setting"!=e.meta.display&&"hidden"!=e.meta.display})},settingRegions:function(){return this.regions.filter(function(e){return"setting"===e.meta.display})},primaryImageUrl:function(){return null!=this.primaryImage.media?piranha.utils.formatUrl("~/manager/api/media/url/"+this.primaryImage.id+"/448/200"):piranha.utils.formatUrl("~/manager/assets/img/empty-image.png")},isExcerptEmpty:function(){return piranha.utils.isEmptyText(this.excerpt)},currentLanguage:function(){if(null===this.languages)return{id:"",title:""};var e=this;return e.languages.find(function(t){return t.id===e.languageId})}},mounted(){},beforeDestroy(){},methods:{bind:function(e){this.id=e.id,this.languageId=e.languageId,this.typeId=e.typeId,this.typeTitle=e.typeTitle,this.groupId=e.groupId,this.groupTitle=e.groupTitle,this.title=e.title,this.excerpt=e.excerpt,this.state=e.state,this.regions=e.regions,this.editors=e.editors,this.languages=e.languages,this.useCategory=e.useCategory,this.useTags=e.useTags,this.usePrimaryImage=e.usePrimaryImage,this.useExcerpt=e.useExcerpt,this.useHtmlExcerpt=e.useHtmlExcerpt,this.useTranslations=e.useTranslations,this.permissions=e.permissions,this.primaryImage=e.primaryImage,this.selectedPermissions=e.selectedPermissions,this.editors.length>0?this.selectedRegion=this.editors[0]:this.contentRegions.length>0&&(this.selectedRegion=this.contentRegions[0].meta)},load:function(e,t){var i=this,n=piranha.baseUrl+"manager/api/content/"+e;null!=t&&(n+="/"+t),fetch(n).then(function(e){return e.json()}).then(function(e){i.bind(e)}).catch(function(e){console.log("error:",e)})},create:function(e){var t=this;fetch(piranha.baseUrl+"manager/api/content/create/"+e).then(function(e){return e.json()}).then(function(e){t.bind(e)}).catch(function(e){console.log("error:",e)})},doHotKeys(e){83===e.keyCode&&e.ctrlKey&&(e.preventDefault(),this.save())},save:function(){this.saving=!0,this.saveInternal(piranha.baseUrl+"manager/api/content/save")},saveInternal:function(e){var t=this,i={id:t.id,languageId:t.languageId,typeId:t.typeId,title:t.title,excerpt:t.excerpt,regions:JSON.parse(JSON.stringify(t.regions)),selectedRoute:t.selectedRoute,selectedPermissions:t.selectedPermissions,primaryImage:{id:t.primaryImage.id}};fetch(e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){var i=t.state;t.id=e.id,t.state=e.state,t.selectedRoute=e.selectedRoute,"new"===i&&"new"!==e.state&&window.history.replaceState({state:"created"},"Edit content",piranha.baseUrl+"manager/content/edit/"+e.typeId+"/"+e.id),piranha.notifications.push(e.status),t.saving=!1,t.eventBus.$emit("onSaved",t.state)}).catch(function(e){console.log("error:",e)})},remove:function(){var e=this;piranha.alert.open({title:piranha.resources.texts.delete,body:piranha.resources.texts.deletePageConfirm,confirmCss:"btn-danger",confirmIcon:"fas fa-trash",confirmText:piranha.resources.texts.delete,onConfirm:function(){var t=e.groupId;fetch(piranha.baseUrl+"manager/api/content/delete/"+e.id).then(function(e){return e.json()}).then(function(e){piranha.notifications.push(e),window.location=piranha.baseUrl+"manager/content/"+t}).catch(function(e){console.log("error:",e)})}})},selectRegion:function(e){this.selectedRegion=e,Vue.nextTick(function(){piranha.editor.refreshMarkdown()})},selectSetting:function(e){this.selectedSetting=e,Vue.nextTick(function(){piranha.editor.refreshMarkdown()})},selectPrimaryImage:function(){null!==this.primaryImage.media?piranha.mediapicker.open(this.updatePrimaryImage,"Image",this.primaryImage.media.folderId):piranha.mediapicker.openCurrentFolder(this.updatePrimaryImage,"Image")},removePrimaryImage:function(){this.primaryImage.id=null,this.primaryImage.media=null},updatePrimaryImage:function(e){"Image"===e.type?(this.primaryImage.id=e.id,this.primaryImage.media=e):console.log("No image was selected")},onExcerptBlur:function(e){this.excerpt=tinyMCE.activeEditor.getContent()}},created:function(){},updated:function(){this.loading=!1},components:{datepicker:vuejsDatepicker}});