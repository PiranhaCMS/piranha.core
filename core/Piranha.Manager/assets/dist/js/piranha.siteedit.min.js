piranha.siteedit=new Vue({el:"#siteedit",data:{loading:!0,id:null,typeId:null,languageId:null,title:null,internalId:null,culture:null,description:null,logo:{id:null,media:null},hostnames:null,isDefault:!1,siteTypes:[],languages:[],regions:[],isNew:!1,isConfirm:!1,confirmTitle:null,selectedRegion:{uid:"uid-settings",name:null,icon:null},callback:null},methods:{load:function(e){self=this,fetch(piranha.baseUrl+"manager/api/site/"+e).then(function(e){return e.json()}).then(function(e){self.id=e.id,self.typeId=e.typeId,self.languageId=e.languageId,self.title=e.title,self.internalId=e.internalId,self.culture=e.culture,self.description=e.description,self.logo=e.logo,self.hostnames=e.hostnames,self.isDefault=e.isDefault,self.siteTypes=e.siteTypes,self.languages=e.languages}).catch(function(e){console.log("error:",e)}),fetch(piranha.baseUrl+"manager/api/site/content/"+e).then(function(e){return e.json()}).then(function(e){404!==e.status?(console.log("Setting regions"),self.regions=e.regions):(console.log("Setting regions to empty array"),self.regions=[])}).catch(function(e){console.log("error:",e)})},save:function(){var e=document.getElementById("siteForm");if(!1!==e.checkValidity()){var t=this,i={id:this.id,typeId:this.typeId,languageId:this.languageId,title:this.title,internalId:this.internalId,culture:this.culture,description:this.description,logo:this.logo,hostnames:this.hostnames,isDefault:this.isDefault};fetch(piranha.baseUrl+"manager/api/site/save",{method:"post",headers:piranha.utils.antiForgeryHeaders(),body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){if("success"===e.type)if(null!=t.id&&null!=t.typeId){var i={id:t.id,typeId:t.typeId,title:t.title,regions:JSON.parse(JSON.stringify(t.regions))};fetch(piranha.baseUrl+"manager/api/site/savecontent",{method:"post",headers:piranha.utils.antiForgeryHeaders(),body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(i){"success"===i.type?(piranha.notifications.push(e),$("#siteedit").modal("hide"),t.callback&&(t.callback(),t.callback=null)):400!==e.status?piranha.notifications.push(i):piranha.notifications.unauthorized()}).catch(function(e){console.log("error:",e)})}else piranha.notifications.push(e),$("#siteedit").modal("hide"),t.callback&&(t.callback(),t.callback=null)}).catch(function(e){console.log("error:",e)})}else e.classList.add("was-validated")},open:function(e,t){document.getElementById("siteForm").classList.remove("was-validated"),this.callback=t,this.isNew=!1,this.selectedRegion={uid:"uid-settings",name:null,icon:null},this.isConfirm=!1,this.confirmTitle=null,this.load(e),$("#siteedit").modal("show"),$("#sitetitle").focus()},create:function(e){var t=this;document.getElementById("siteForm").classList.remove("was-validated"),fetch(piranha.baseUrl+"manager/api/site/create").then(function(e){return e.json()}).then(function(i){t.id=i.id,t.typeId=i.typeId,t.title=i.title,t.internalId=i.internalId,t.culture=i.culture,t.description=i.description,t.hostnames=i.hostnames,t.isDefault=i.isDefault,t.siteTypes=i.siteTypes,t.languages=i.languages,t.isNew=!0,t.callback=e,t.selectedRegion={uid:"uid-settings",name:null,icon:null}}).catch(function(e){console.log("error:",e)}),$("#siteedit").modal("show"),$("#sitetitle").focus()},confirm:function(){this.isConfirm=!0},cancel:function(){this.isConfirm=!1,this.confirmTitle=null},remove:function(){this.isConfirm=!1,this.confirmTitle=null;var e=this;fetch(piranha.baseUrl+"manager/api/site/delete",{method:"delete",headers:piranha.utils.antiForgeryHeaders(),body:JSON.stringify(e.id)}).then(function(e){return e.json()}).then(function(t){piranha.notifications.push(t),"success"===t.type&&($("#siteedit").modal("hide"),e.callback&&(e.callback(),e.callback=null))}).catch(function(e){console.log("error:",e)})},selectRegion:function(e){this.selectedRegion=e},refreshLanguageList(){fetch(piranha.baseUrl+"manager/api/language").then(function(e){return e.json()}).then(function(e){self.languages=e.items}).catch(function(e){console.log("error:",e)})}},updated:function(){this.loading=!1}}),$("#siteedit").on("shown.bs.modal",function(){$("#sitetitle").trigger("focus")});